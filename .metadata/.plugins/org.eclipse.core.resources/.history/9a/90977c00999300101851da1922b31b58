<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ page import="java.sql.*"%>       
<%@ page import="java.util.Date" %>
<%@ page import="java.text.SimpleDateFormat" %>
<%@ page import="java.util.Arrays" %>
<%@ page import="lib.DB" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Modify</title>
<style>
*{
	margin: 0 auto;
	padding: 0;
	text-align: center;
	box-sizing: border-box;
}
.write-form table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
    margin: 20px auto;
    max-width: 600px;
    background-color: #fff;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.write-form td {
    padding: 15px;
    border: 1px solid #e9ecef;
}

.write-form td:first-child {
    background-color: #f8f9fa;
    font-weight: bold;
    color: #495057;
    text-align: center;
    width: 120px;
}

.write-form input[type="text"],
.write-form textarea {
    width: calc(100% - 24px);
    padding: 10px 12px;
    border: 1px solid #ced4da;
    border-radius: 4px;
    font-size: 14px;
    box-sizing: border-box;
    text-align: left;
}

.write-form textarea {
    height: 200px;
    resize: vertical;
}

.write-form .button-container {
    text-align: right;
}

.write-form input[type="submit"],
.write-form .btn-cancel {
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    font-size: 14px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    margin-left: 8px;
}

.write-form input[type="submit"] {
    background-color: #007bff;
    color: white;
}

.write-form input[type="submit"]:hover {
    background-color: #0056b3;
}

.write-form .btn-cancel {
    background-color: #6c757d;
    color: white;
}

.write-form .btn-cancel:hover {
    background-color: #5a6268;
}

/* a 태그 안에 button을 넣었을 때 스타일 */
.write-form a {
    text-decoration: none;
}
</style>
</head>
<body>
<%
String idx = request.getParameter("idx");
String delpass = request.getParameter("delpass");

Connection conn=null;
Statement st = null;
ResultSet rs = null;
String sql = null;

try{
    conn = DB.getConnection();
    
   sql = " SELECT b.*, m.upassword as pass FROM board b LEFT JOIN member m ON b.uid = m.uid where b.idx = '"+idx+"' ";

   st = conn.createStatement();
   rs = st.executeQuery(sql);

  }catch(Exception e){ 
    e.printStackTrace();
    out.println(sql);
 }
String uid = "";
String pass = "";
String title = "";
String content = "";
String ip = "";
String originalfile = "";

if(rs != null){
	rs.next();
	title = rs.getString("title");
	content = rs.getString("content");
	ip = rs.getString("ip");
	uid = rs.getString("uid");
	pass = rs.getString("pass");
	originalfile = rs.getString("originalfile");
}
%>

<%@ include file="op_top.jsp" %>
<%@ include file="op_logincheck.jsp" %>

<%

if (login_rank == 9) {
	
}else if (0 <= login_rank && login_rank < 9) {
	if(login_id == null || !login_id.equals(uid)) {
		%>
		<script>
		alert("권한 없음");
		location.replace("view.jsp?idx=<%= idx %>");
		</script>
		<%
		return;
	}
}

%>

<h1>수정</h1><br>
<form action="modify_proc.jsp" method="post" enctype="multipart/form-data" class="write-form">
	<input type="hidden" name="idx" value="<%= idx %>">
	<input type="hidden" name="ip" value="<%= ip %>">
	<table>

		<tr>
			<td>제목</td>
			<td><input type="text" name="writetitle" value="<%= title %>"></td>
		</tr>
		
		<tr>
			<td>내용</td>
			<td>
				<textarea class="text" name="writetext"><%= content %></textarea>
			</td>
		</tr>
		
		<tr>
			<td>파일</td>
			<td>
			<input type="checkbox" name="filecheck" id="myCheckbox" value="on" onchange="toggleContent()">
			<label for="myCheckbox">새로운 파일 업로드</label>
	
			<div id="additionalContent" style="display: none;">
			    <input type="file" name="upfile" accept=".gif, .jpg, .png"><br>
			</div>
			<script>
			function toggleContent() {
			    var checkbox = document.getElementById('myCheckbox');
			    var content = document.getElementById('additionalContent');
			
			    if (checkbox.checked) {
			        content.style.display = 'block'; 
			    } else {
			        content.style.display = 'none';
			    }
			}
			</script>
			
			<%
				if (originalfile != null) {
			%>
					<br>기존 파일 : <%= originalfile %>
			<%
				}
			%>
			</td>
		</tr>
		
		<tr>
			<td colspan="2">
				<input type="submit" value="수정">
				<a href="view.jsp?idx=<%= idx %>"><button type="button" class="btn-cancel">취소</button></a>
			</td>
		</tr>
		
	</table>
</form>

</body>
</html>