<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ page import="java.sql.*"%>    
<%@ page import="lib.DB" %>
<%@page import="java.io.File"%>

<%
String idx = request.getParameter("idx");
String delpass = request.getParameter("delpass");
String pwd = null;

String sql = "";
Connection conn=null;
PreparedStatement ps = null;
ResultSet rs = null;

try{
    conn = DB.getConnection();
    {
    	sql = "select * from board where idx=?";
    	ps = conn.prepareStatement(sql);
    	ps.setString(1, idx);
		rs = ps.executeQuery();
		rs.next();
		pwd = rs.getString("pwd");
    }
    
    if (!delpass.equals(pwd)) {
    	%>
    		<script>
				alert("비밀번호가 일치하지 않습니다.");
				location.replace("delete.jsp?idx=<%= idx %>");
			</script>
    	<%
    	return;
    }
    

   sql = " delete from board where idx ='"+idx+"' ";

   Statement st = conn.createStatement();

   st.executeUpdate(sql);

   %>
	<script>
		alert("삭제 성공");
	</script>
	<%
   
   response.sendRedirect("list.jsp");
    
  }catch(Exception e){ 
    e.printStackTrace();
    out.println(sql);
  }finally {
	  	if (rs != null){
		   rs.close();
		}

		if (conn != null){
		   conn.close();
		}
  }

%>